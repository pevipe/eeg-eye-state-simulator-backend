# EegEyeStateSimulator - backend
## Description
This is the project corresponding to the backend of the simulator of a control system based on EEG
signals associated to open and closed eye states. Its frontend can be found on [this 
repository](https://github.com/pevipe/eeg-eye-state-simulator-frontend).

Both are part of the End-of-Degree Project of the Degree in Computer Engineering by Pelayo Vieites
Pérez, from the University of A Coruña. 


## Requirements
### Development
- Python 3.11 and pipenv

### Running
- Python 3.11 (if running in local)
- Pipenv (if running in local)
- Docker (if running in a container)

## Running the application in local
### Configuration
#### Environment variables
For the application to run successfully, the following environment variables must be set:
- `FRONTEND_URL`: URL where the frontend is running. This is used to allow CORS requests.
The default URL, if running the application in local, is `http://localhost:3200`. If running
in a container with the given functionality, the URL must be the one where the frontend is
running. By default, the frontend is expected to be running in `http://localhost` (port 80).
- `SIMULATOR_PERSISTENT_PATH`: Path where the data of the application must be stored. This 
includes the preloaded subjects, with their data and optimized hyperparameters. It is the
path where the `eeg-persistence.zip` is decompressed.

Thus, the frontend should have a running url, and the provided persistence `zip` file must
be decompressed in the same path as set in its corresponding environment variable.

#### Installing dependencies
To install the dependencies, simply run (it may take a while):
```bash
pipenv install
```

#### Run the API
To run the backend for the eeg-simulator, the recommended way is using the installed
`pipenv`:
```bash
pipenv run uvicorn src.main:create_app --factory --reload
```

## Running the application in a Docker container
This is the recommended way to run the application, as it is makes configuration transparent
to the user and works out of the box. To this purpose, a Dockerfile to build the image is provided.
The mentioned environment variables are already set in the Dockerfile, so as long as the frontend
is on the same URL (which, if run in a container as specified in its 
[README](https://github.com/pevipe/TFG_frontend/blob/main/README.md#run-the-project), it will be),
and the `.zip` file is not moved, it will work.

To build the Docker image simply run `docker build -t <image_name:latest> .` from the root 
directory of the project.

### Run the Docker image
Once the image has been built, it can be run with `docker run -p 8000:8000 <image_name:latest>`,
and the API will be available at `http://localhost:8000`. To see the frontend of the application, 
follow [these instructions](https://github.com/pevipe/TFG_frontend/blob/main/README.md#run-the-project).

Note that, for it to work properly, the image with the backend of the application (available 
[here](https://github.com/pevipe/eeg-eye-state-simulator-backend)) must also be built and running.

## Autogenerated documentation page
The API documentation will be available at `http://localhost:8000/docs` when running the application.
It includes the endpoints, and their parameters. Moreover, it allows to test the endpoints directly
from the browser, manually entering the parameters to see the expected outcomes.
